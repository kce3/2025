import streamlit as st
import random

# -----------------------
# 1. í˜ì´ì§€ ì„¤ì • + ìŠ¤íƒ€ì¼
# -----------------------
st.set_page_config(page_title="ì˜¤ëŠ˜ ë­ ë¨¹ì§€? ğŸ±", page_icon="ğŸ½ï¸", layout="centered")
st.markdown("""
<style>
body {background-color: #FFF5E6; color:#4D2600;}
.stButton>button {background-color: #FF8C42; color:white; font-size:16px;}
</style>
""", unsafe_allow_html=True)

st.title("ğŸ½ï¸ ì˜¤ëŠ˜ ê±´ê°•ì‹ ë©”ë‰´ ì¶”ì²œ")
st.write("ì§ˆí™˜ê³¼ ì„ í˜¸ë„ë¥¼ ê³ ë ¤í•´ ì˜¤ëŠ˜ì˜ í•œ ë¼~ì„¸ ë¼ ë©”ë‰´ë¥¼ ì¶”ì²œí•©ë‹ˆë‹¤ ğŸ˜‹")

# -----------------------
# 2. ì‚¬ìš©ì ì…ë ¥
# -----------------------
diseases = st.multiselect(
    "ğŸ’Š ê°€ì§€ê³  ìˆëŠ” ì§ˆí™˜ ì„ íƒ (1ê°œ ì´ìƒ)",
    ["ê³ í˜ˆì••", "ë‹¹ë‡¨", "ê³ ì§€í˜ˆì¦", "ê³¼ì²´ì¤‘/ë¹„ë§Œ", "ë¹ˆí˜ˆ", "ìœ„ì—¼", "ì—­ë¥˜ì„± ì‹ë„ì—¼", "ì•„í† í”¼/ì•Œë ˆë¥´ê¸°", "ê³¨ë‹¤ê³µì¦"]
)

# ëª‡ ë¼ ë¨¹ì„ì§€ ì„ íƒ
meal_count = st.slider("ì˜¤ëŠ˜ ëª‡ ë¼ë¥¼ ë“œì‹¤ ì˜ˆì •ì¸ê°€ìš”?", 1, 3, 1)

# ë©”ë‰´ ì¶”ì²œ ë°©ì‹ ì„ íƒ
st.subheader("ğŸ´ ë©”ë‰´ ì¶”ì²œ ë°©ì‹ ì„ íƒ")
recommend_mode = st.radio(
    "ê° ë¼ë§ˆë‹¤ ë©”ë‰´ë¥¼ ì–´ë–»ê²Œ ì¶”ì²œë°›ì„ê¹Œìš”?",
    ("ì‹œìŠ¤í…œ ëœë¤ ì¶”ì²œ", "ë³¸ì¸ì´ ì„ íƒ")
)

# -----------------------
# 3. ë©”ë‰´ DB
# -----------------------
menu_db = {
    "ê³ í˜ˆì••": [("ì €ì—¼ ë‘ë¶€ë®ë°¥", 7000), ("ê³ ë“±ì–´êµ¬ì´ ì •ì‹", 8000), ("ë‹­ê°€ìŠ´ì‚´ ìƒëŸ¬ë“œ", 7000)],
    "ë‹¹ë‡¨": [("í˜„ë¯¸ë°¥ ë„ì‹œë½", 7500), ("ì—°ì–´ìƒëŸ¬ë“œ", 8500), ("ë‘ë¶€ìŠ¤í…Œì´í¬ ë„ì‹œë½", 7500)],
    "ê³ ì§€í˜ˆì¦": [("ê·€ë¦¬ì£½", 6500), ("ì—°ì–´ìŠ¤í…Œì´í¬", 9000), ("ì±„ì†Œêµ¬ì´ í”Œë˜í„°", 8000)],
    "ê³¼ì²´ì¤‘/ë¹„ë§Œ": [("ë‹¤ì´ì–´íŠ¸ ë„ì‹œë½", 7500), ("ê·¸ë¦­ìš”ê±°íŠ¸ë³¼", 6500), ("í€´ë…¸ì•„ ìƒëŸ¬ë“œ", 7000)],
    "ë¹ˆí˜ˆ": [("ì†Œê³ ê¸° ë¯¸ì—­êµ­ ì •ì‹", 8000), ("ê°„ë³¶ìŒ ë®ë°¥", 7500), ("ì‹œê¸ˆì¹˜ ì˜¤ë¯ˆë › ë„ì‹œë½", 7000)],
    "ìœ„ì—¼": [("ì–‘ë°°ì¶”ì£½", 6000), ("ê°ììˆ˜í”„", 6500), ("ë°”ë‚˜ë‚˜ ìŠ¤ë¬´ë””", 5500)],
    "ì—­ë¥˜ì„± ì‹ë„ì—¼": [("ë‹­ì£½", 6000), ("í°ì‚´ìƒì„ êµ¬ì´", 7500), ("ì±„ì†ŒìŠ¤í”„ + í˜¸ë°€ë¹µ", 7000)],
    "ì•„í† í”¼/ì•Œë ˆë¥´ê¸°": [("ê¸°ë³¸ ë„ì‹œë½(ìŒ€ë°¥+ì±„ì†Œ+ë‹¬ê±€)", 7000), ("ì‚¬ê³¼ ìƒëŸ¬ë“œ", 6000), ("ì±„ì‹ ë„ì‹œë½", 7500)],
    "ê³¨ë‹¤ê³µì¦": [("ë‘ë¶€ ìŠ¤í…Œì´í¬ ì •ì‹", 7500), ("ë©¸ì¹˜ë³¶ìŒê³¼ ì‹œê¸ˆì¹˜ë‚˜ë¬¼ ë„ì‹œë½", 7000), ("ìš°ìœ +ìš”ê±°íŠ¸ ìŠ¤ë¬´ë””", 5500)]
}

# -----------------------
# 4. ì¶”ì²œ ë©”ë‰´ ê³„ì‚°
# -----------------------
recommended_menus = set()
if diseases:
    for d in diseases:
        recommended_menus.update(menu_db.get(d, []))
recommended_menus = list(recommended_menus)

# ë¼ë‹ˆ ì´ë¦„
meal_names = ["ğŸ³ ì•„ì¹¨", "ğŸ¥— ì ì‹¬", "ğŸ² ì €ë…"][:meal_count]
meals = {}

# -----------------------
# 5. ë¼ë‹ˆë³„ ë©”ë‰´ ì¶”ì²œ/ì„ íƒ
# -----------------------
for meal in meal_names:
    st.subheader(f"{meal}")
    if recommend_mode == "ì‹œìŠ¤í…œ ëœë¤ ì¶”ì²œ":
        menu_name, price = random.choice(recommended_menus)
        meals[meal] = (menu_name, price)
        st.markdown(f"- ì¶”ì²œ ë©”ë‰´: **{menu_name}** ğŸ’° {price}ì›")
    else:  # ë³¸ì¸ì´ ì„ íƒ
        options = [m[0] for m in recommended_menus]
        choice = st.selectbox("ë©”ë‰´ ì„ íƒ", ["ì„ íƒí•˜ì„¸ìš”"] + options, key=meal)
        if choice != "ì„ íƒí•˜ì„¸ìš”":
            price = next((p for n, p in recommended_menus if n == choice), 5000)
            meals[meal] = (choice, price)

# -----------------------
# 6. ìµœì¢… ì£¼ë¬¸ í‘œì‹œ
# -----------------------
if meals and st.button("ğŸšš ì´ ì‹ë‹¨ ì£¼ë¬¸í•˜ê¸°"):
    total_price = sum(price for _, price in meals.values())
    st.subheader("âœ… ì£¼ë¬¸ ì™„ë£Œ")
    for meal_name, (menu_name, price) in meals.items():
        st.write(f"{meal_name}: {menu_name} ğŸ’° {price}ì›")
    st.write(f"ğŸ’° **ì´ ê°€ê²©: {total_price}ì›**")
    st.success("ê³§ ê±´ê°•ì‹ì´ ë°°ì†¡ë©ë‹ˆë‹¤! ğŸ¥³")
